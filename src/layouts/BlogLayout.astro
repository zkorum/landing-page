---
import BaseLayout from './BaseLayout.astro';
import { getRelativeLocaleUrl } from 'astro:i18n';
import { loadTranslationsWithFallback, createTranslationFunction } from '../utils/i18n';

interface Props {
  title: string;
  description: string;
  author: string;
  date: string;
  image?: string;
}

const { title, description, author, date, image } = Astro.props;

const currentLocale = Astro.currentLocale || 'en';

const localeUrl = (path: string) => {
  const url = getRelativeLocaleUrl(currentLocale, path);
  return url.endsWith('/') && url.length > 1 ? url.slice(0, -1) : url;
};

// Load translations with fallback support
const translations = await loadTranslationsWithFallback(currentLocale, 'BlogLayout');
const t = createTranslationFunction(translations);
---

<BaseLayout
  title={`${title} - Agora Citizen Network`}
  description={description}
  image={image}
  type="article"
>
  <!-- Article Header -->
  <section class="blog-header">
    <div class="container">
      <div class="row">
        <div class="col-md-10 offset-md-1">
          <h1 class="unbounded dark-blue">{title}</h1>
          <p class="dark-blue">{description}</p>
          <div class="blog-meta mt-4" style="justify-content: center;">
            <span class="blog-author">{author}</span>
            <span class="mx-3">â€¢</span>
            <span class="blog-date">{date}</span>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Article Content -->
  <section class="blog-article">
    <div class="container">
      <div class="row">
        <div class="col-md-8 offset-md-2">
          <slot />

          <div class="mt-5 text-center">
            <a href={localeUrl("/blog")} class="about-btn">{t("backToImpactStories")}</a>
          </div>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>
